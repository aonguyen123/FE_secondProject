{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _divider = require('antd/lib/divider');\n\nvar _divider2 = _interopRequireDefault(_divider);\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _dec, _dec2, _dec3, _class, _desc, _value, _class2;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _bizcharts = require('bizcharts');\n\nvar _dataSet = require('@antv/data-set');\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _reactFittext = require('react-fittext');\n\nvar _reactFittext2 = _interopRequireDefault(_reactFittext);\n\nvar _debounce = require('lodash-decorators/debounce');\n\nvar _debounce2 = _interopRequireDefault(_debounce);\n\nvar _bind = require('lodash-decorators/bind');\n\nvar _bind2 = _interopRequireDefault(_bind);\n\nvar _autoHeight = require('../autoHeight');\n\nvar _autoHeight2 = _interopRequireDefault(_autoHeight);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object['ke' + 'ys'](descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object['define' + 'Property'](target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nvar styles = {\n  'pie': 'antd-pro-charts-pie-pie',\n  'chart': 'antd-pro-charts-pie-chart',\n  'hasLegend': 'antd-pro-charts-pie-hasLegend',\n  'legend': 'antd-pro-charts-pie-legend',\n  'dot': 'antd-pro-charts-pie-dot',\n  'line': 'antd-pro-charts-pie-line',\n  'legendTitle': 'antd-pro-charts-pie-legendTitle',\n  'percent': 'antd-pro-charts-pie-percent',\n  'value': 'antd-pro-charts-pie-value',\n  'title': 'antd-pro-charts-pie-title',\n  'total': 'antd-pro-charts-pie-total',\n  'legendBlock': 'antd-pro-charts-pie-legendBlock'\n};\n/* eslint react/no-danger:0 */\n\nvar Pie = (_dec = (0, _autoHeight2.default)(), _dec2 = (0, _bind2.default)(), _dec3 = (0, _debounce2.default)(300), _dec(_class = (_class2 = function (_Component) {\n  _inherits(Pie, _Component);\n\n  function Pie() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, Pie);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = Pie.__proto__ || Object.getPrototypeOf(Pie)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\n      legendData: [],\n      legendBlock: false\n    }, _this.getG2Instance = function (chart) {\n      _this.chart = chart;\n      requestAnimationFrame(function () {\n        _this.getLegendData();\n\n        _this.resize();\n      });\n    }, _this.getLegendData = function () {\n      if (!_this.chart) return;\n\n      var geom = _this.chart.getAllGeoms()[0]; // 获取所有的图形\n\n\n      if (!geom) return;\n      var items = geom.get('dataArray') || []; // 获取图形对应的\n\n      var legendData = items.map(function (item) {\n        /* eslint no-underscore-dangle:0 */\n        var origin = item[0]._origin;\n        origin.color = item[0].color;\n        origin.checked = true;\n        return origin;\n      });\n\n      _this.setState({\n        legendData: legendData\n      });\n    }, _this.handleRoot = function (n) {\n      _this.root = n;\n    }, _this.handleLegendClick = function (item, i) {\n      var newItem = item;\n      newItem.checked = !newItem.checked;\n      var legendData = _this.state.legendData;\n      legendData[i] = newItem;\n      var filteredLegendData = legendData.filter(function (l) {\n        return l.checked;\n      }).map(function (l) {\n        return l.x;\n      });\n\n      if (_this.chart) {\n        _this.chart.filter('x', function (val) {\n          return filteredLegendData.indexOf(val) > -1;\n        });\n      }\n\n      _this.setState({\n        legendData: legendData\n      });\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(Pie, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      window.addEventListener('resize', function () {\n        _this2.requestRef = requestAnimationFrame(function () {\n          return _this2.resize();\n        });\n      }, {\n        passive: true\n      });\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate(preProps) {\n      var data = this.props.data;\n\n      if (data !== preProps.data) {\n        // because of charts data create when rendered\n        // so there is a trick for get rendered time\n        this.getLegendData();\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      window.cancelAnimationFrame(this.requestRef);\n      window.removeEventListener('resize', this.resize);\n      this.resize.cancel();\n    } // for custom lengend view\n\n  }, {\n    key: 'resize',\n    // for window resize auto responsive legend\n    value: function resize() {\n      var hasLegend = this.props.hasLegend;\n      var legendBlock = this.state.legendBlock;\n\n      if (!hasLegend || !this.root) {\n        window.removeEventListener('resize', this.resize);\n        return;\n      }\n\n      if (this.root.parentNode.clientWidth <= 380) {\n        if (!legendBlock) {\n          this.setState({\n            legendBlock: true\n          });\n        }\n      } else if (legendBlock) {\n        this.setState({\n          legendBlock: false\n        });\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames,\n          _this3 = this;\n\n      var _props = this.props,\n          valueFormat = _props.valueFormat,\n          subTitle = _props.subTitle,\n          total = _props.total,\n          _props$hasLegend = _props.hasLegend,\n          hasLegend = _props$hasLegend === undefined ? false : _props$hasLegend,\n          className = _props.className,\n          style = _props.style,\n          height = _props.height,\n          _props$forceFit = _props.forceFit,\n          forceFit = _props$forceFit === undefined ? true : _props$forceFit,\n          percent = _props.percent,\n          color = _props.color,\n          _props$inner = _props.inner,\n          inner = _props$inner === undefined ? 0.75 : _props$inner,\n          _props$animate = _props.animate,\n          animate = _props$animate === undefined ? true : _props$animate,\n          colors = _props.colors,\n          _props$lineWidth = _props.lineWidth,\n          lineWidth = _props$lineWidth === undefined ? 1 : _props$lineWidth;\n      var _state = this.state,\n          legendData = _state.legendData,\n          legendBlock = _state.legendBlock;\n      var pieClassName = (0, _classnames2.default)(styles.pie, className, (_classNames = {}, _defineProperty(_classNames, styles.hasLegend, !!hasLegend), _defineProperty(_classNames, styles.legendBlock, legendBlock), _classNames));\n      var _props2 = this.props,\n          propsData = _props2.data,\n          _props2$selected = _props2.selected,\n          propsSelected = _props2$selected === undefined ? true : _props2$selected,\n          _props2$tooltip = _props2.tooltip,\n          propsTooltip = _props2$tooltip === undefined ? true : _props2$tooltip;\n      var data = propsData || [];\n      var selected = propsSelected;\n      var tooltip = propsTooltip;\n      var defaultColors = colors;\n      data = data || [];\n      selected = selected || true;\n      tooltip = tooltip || true;\n      var formatColor = void 0;\n      var scale = {\n        x: {\n          type: 'cat',\n          range: [0, 1]\n        },\n        y: {\n          min: 0\n        }\n      };\n\n      if (percent || percent === 0) {\n        selected = false;\n        tooltip = false;\n\n        formatColor = function formatColor(value) {\n          if (value === '占比') {\n            return color || 'rgba(24, 144, 255, 0.85)';\n          }\n\n          return '#F0F2F5';\n        };\n\n        data = [{\n          x: '占比',\n          y: parseFloat(percent)\n        }, {\n          x: '反比',\n          y: 100 - parseFloat(percent)\n        }];\n      }\n\n      var tooltipFormat = ['x*percent', function (x, p) {\n        return {\n          name: x,\n          value: (p * 100).toFixed(2) + '%'\n        };\n      }];\n      var padding = [12, 0, 12, 0];\n      var dv = new _dataSet.DataView();\n      dv.source(data).transform({\n        type: 'percent',\n        field: 'y',\n        dimension: 'x',\n        as: 'percent'\n      });\n      return _react2.default.createElement('div', {\n        ref: this.handleRoot,\n        className: pieClassName,\n        style: style\n      }, _react2.default.createElement(_reactFittext2.default, {\n        maxFontSize: 25\n      }, _react2.default.createElement('div', {\n        className: styles.chart\n      }, _react2.default.createElement(_bizcharts.Chart, {\n        scale: scale,\n        height: height,\n        forceFit: forceFit,\n        data: dv,\n        padding: padding,\n        animate: animate,\n        onGetG2Instance: this.getG2Instance\n      }, !!tooltip && _react2.default.createElement(_bizcharts.Tooltip, {\n        showTitle: false\n      }), _react2.default.createElement(_bizcharts.Coord, {\n        type: 'theta',\n        innerRadius: inner\n      }), _react2.default.createElement(_bizcharts.Geom, {\n        style: {\n          lineWidth: lineWidth,\n          stroke: '#fff'\n        },\n        tooltip: tooltip && tooltipFormat,\n        type: 'intervalStack',\n        position: 'percent',\n        color: ['x', percent || percent === 0 ? formatColor : defaultColors],\n        selected: selected\n      })), (subTitle || total) && _react2.default.createElement('div', {\n        className: styles.total\n      }, subTitle && _react2.default.createElement('h4', {\n        className: 'pie-sub-title'\n      }, subTitle), total && _react2.default.createElement('div', {\n        className: 'pie-stat'\n      }, typeof total === 'function' ? total() : total)))), hasLegend && _react2.default.createElement('ul', {\n        className: styles.legend\n      }, legendData.map(function (item, i) {\n        return _react2.default.createElement('li', {\n          key: item.x,\n          onClick: function onClick() {\n            return _this3.handleLegendClick(item, i);\n          }\n        }, _react2.default.createElement('span', {\n          className: styles.dot,\n          style: {\n            backgroundColor: !item.checked ? '#aaa' : item.color\n          }\n        }), _react2.default.createElement('span', {\n          className: styles.legendTitle\n        }, item.x), _react2.default.createElement(_divider2.default, {\n          type: 'vertical'\n        }), _react2.default.createElement('span', {\n          className: styles.percent\n        }, (Number.isNaN(item.percent) ? 0 : item.percent * 100).toFixed(2) + '%'), _react2.default.createElement('span', {\n          className: styles.value\n        }, valueFormat ? valueFormat(item.y) : item.y));\n      })));\n    }\n  }]);\n\n  return Pie;\n}(_react.Component), _applyDecoratedDescriptor(_class2.prototype, 'resize', [_dec2, _dec3], Object.getOwnPropertyDescriptor(_class2.prototype, 'resize'), _class2.prototype), _class2)) || _class);\nexports.default = Pie;\nmodule.exports = exports.default;","map":null,"metadata":{},"sourceType":"script"}