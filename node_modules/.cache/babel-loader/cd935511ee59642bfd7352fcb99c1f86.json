{"ast":null,"code":"import { callAPI } from './index';\nimport { getToken, checkExpiredToken, setAuthToken, setToken, removeToken } from './../config';\nexport async function getAccessToken(history) {\n  try {\n    const tokenString = getToken();\n    const token = JSON.parse(tokenString);\n    const accessToken = token.accessToken;\n    const refreshToken = token.refreshToken;\n\n    if (checkExpiredToken(refreshToken)) {\n      if (!checkExpiredToken(accessToken)) {\n        const newToken = await callAPI('/auth/refreshToken', 'POST', {\n          refreshToken\n        });\n        setAuthToken(newToken.data.accessToken);\n        setToken(newToken.data);\n      }\n\n      return true;\n    } else {\n      removeToken();\n      history.push('/login');\n      return false;\n    }\n  } catch (e) {\n    //removeToken();\n    history.push('/login');\n    return false;\n  }\n}","map":{"version":3,"sources":["E:/web_ungdung/frontend/src/common/refreshToken.common.js"],"names":["callAPI","getToken","checkExpiredToken","setAuthToken","setToken","removeToken","getAccessToken","history","tokenString","token","JSON","parse","accessToken","refreshToken","newToken","data","push","e"],"mappings":"AAAA,SAASA,OAAT,QAAwB,SAAxB;AACA,SACIC,QADJ,EAEIC,iBAFJ,EAGIC,YAHJ,EAIIC,QAJJ,EAKIC,WALJ,QAMO,aANP;AAQA,OAAO,eAAeC,cAAf,CAA8BC,OAA9B,EAAuC;AAC1C,MAAI;AACA,UAAMC,WAAW,GAAGP,QAAQ,EAA5B;AACA,UAAMQ,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWH,WAAX,CAAd;AACA,UAAMI,WAAW,GAAGH,KAAK,CAACG,WAA1B;AACA,UAAMC,YAAY,GAAGJ,KAAK,CAACI,YAA3B;;AACA,QAAIX,iBAAiB,CAACW,YAAD,CAArB,EAAqC;AACjC,UAAI,CAACX,iBAAiB,CAACU,WAAD,CAAtB,EAAqC;AACjC,cAAME,QAAQ,GAAG,MAAMd,OAAO,CAAC,oBAAD,EAAuB,MAAvB,EAA+B;AACzDa,UAAAA;AADyD,SAA/B,CAA9B;AAGAV,QAAAA,YAAY,CAACW,QAAQ,CAACC,IAAT,CAAcH,WAAf,CAAZ;AACAR,QAAAA,QAAQ,CAACU,QAAQ,CAACC,IAAV,CAAR;AACH;;AACD,aAAO,IAAP;AACH,KATD,MASO;AACHV,MAAAA,WAAW;AACXE,MAAAA,OAAO,CAACS,IAAR,CAAa,QAAb;AACA,aAAO,KAAP;AACH;AACJ,GAnBD,CAmBE,OAAOC,CAAP,EAAU;AACR;AACAV,IAAAA,OAAO,CAACS,IAAR,CAAa,QAAb;AACA,WAAO,KAAP;AACH;AACJ","sourcesContent":["import { callAPI } from './index';\r\nimport {\r\n    getToken,\r\n    checkExpiredToken,\r\n    setAuthToken,\r\n    setToken,\r\n    removeToken\r\n} from './../config';\r\n\r\nexport async function getAccessToken(history) {\r\n    try {\r\n        const tokenString = getToken();\r\n        const token = JSON.parse(tokenString);\r\n        const accessToken = token.accessToken;\r\n        const refreshToken = token.refreshToken;\r\n        if (checkExpiredToken(refreshToken)) {\r\n            if (!checkExpiredToken(accessToken)) {\r\n                const newToken = await callAPI('/auth/refreshToken', 'POST', {\r\n                    refreshToken\r\n                });\r\n                setAuthToken(newToken.data.accessToken);\r\n                setToken(newToken.data);\r\n            }\r\n            return true;\r\n        } else {\r\n            removeToken();\r\n            history.push('/login');\r\n            return false;\r\n        }\r\n    } catch (e) {\r\n        //removeToken();\r\n        history.push('/login');\r\n        return false;\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}