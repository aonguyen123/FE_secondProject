{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _dec, _class;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _bizcharts = require('bizcharts');\n\nvar _dataSet = require('@antv/data-set');\n\nvar _dataSet2 = _interopRequireDefault(_dataSet);\n\nvar _bizchartsPluginSlider = require('bizcharts-plugin-slider');\n\nvar _bizchartsPluginSlider2 = _interopRequireDefault(_bizchartsPluginSlider);\n\nvar _autoHeight = require('../autoHeight');\n\nvar _autoHeight2 = _interopRequireDefault(_autoHeight);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar styles = {\n  'timelineChart': 'antd-pro-charts-timeline-chart-timelineChart'\n};\nvar TimelineChart = (_dec = (0, _autoHeight2.default)(), _dec(_class = function (_React$Component) {\n  _inherits(TimelineChart, _React$Component);\n\n  function TimelineChart() {\n    _classCallCheck(this, TimelineChart);\n\n    return _possibleConstructorReturn(this, (TimelineChart.__proto__ || Object.getPrototypeOf(TimelineChart)).apply(this, arguments));\n  }\n\n  _createClass(TimelineChart, [{\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          title = _props.title,\n          _props$height = _props.height,\n          height = _props$height === undefined ? 400 : _props$height,\n          _props$padding = _props.padding,\n          padding = _props$padding === undefined ? [60, 20, 40, 40] : _props$padding,\n          _props$titleMap = _props.titleMap,\n          titleMap = _props$titleMap === undefined ? {\n        y1: 'y1',\n        y2: 'y2'\n      } : _props$titleMap,\n          _props$borderWidth = _props.borderWidth,\n          borderWidth = _props$borderWidth === undefined ? 2 : _props$borderWidth,\n          sourceData = _props.data;\n      var data = Array.isArray(sourceData) ? sourceData : [{\n        x: 0,\n        y1: 0,\n        y2: 0\n      }];\n      data.sort(function (a, b) {\n        return a.x - b.x;\n      });\n      var max = void 0;\n\n      if (data[0] && data[0].y1 && data[0].y2) {\n        max = Math.max([].concat(_toConsumableArray(data)).sort(function (a, b) {\n          return b.y1 - a.y1;\n        })[0].y1, [].concat(_toConsumableArray(data)).sort(function (a, b) {\n          return b.y2 - a.y2;\n        })[0].y2);\n      }\n\n      var ds = new _dataSet2.default({\n        state: {\n          start: data[0].x,\n          end: data[data.length - 1].x\n        }\n      });\n      var dv = ds.createView();\n      dv.source(data).transform({\n        type: 'filter',\n        callback: function callback(obj) {\n          var date = obj.x;\n          return date <= ds.state.end && date >= ds.state.start;\n        }\n      }).transform({\n        type: 'map',\n        callback: function callback(row) {\n          var newRow = _extends({}, row);\n\n          newRow[titleMap.y1] = row.y1;\n          newRow[titleMap.y2] = row.y2;\n          return newRow;\n        }\n      }).transform({\n        type: 'fold',\n        fields: [titleMap.y1, titleMap.y2],\n        // 展开字段集\n        key: 'key',\n        // key字段\n        value: 'value' // value字段\n\n      });\n      var timeScale = {\n        type: 'time',\n        tickInterval: 60 * 60 * 1000,\n        mask: 'HH:mm',\n        range: [0, 1]\n      };\n      var cols = {\n        x: timeScale,\n        value: {\n          max: max,\n          min: 0\n        }\n      };\n\n      var SliderGen = function SliderGen() {\n        return _react2.default.createElement(_bizchartsPluginSlider2.default, {\n          padding: [0, padding[1] + 20, 0, padding[3]],\n          width: 'auto',\n          height: 26,\n          xAxis: 'x',\n          yAxis: 'y1',\n          scales: {\n            x: timeScale\n          },\n          data: data,\n          start: ds.state.start,\n          end: ds.state.end,\n          backgroundChart: {\n            type: 'line'\n          },\n          onChange: function onChange(_ref) {\n            var startValue = _ref.startValue,\n                endValue = _ref.endValue;\n            ds.setState('start', startValue);\n            ds.setState('end', endValue);\n          }\n        });\n      };\n\n      return _react2.default.createElement('div', {\n        className: styles.timelineChart,\n        style: {\n          height: height + 30\n        }\n      }, _react2.default.createElement('div', null, title && _react2.default.createElement('h4', null, title), _react2.default.createElement(_bizcharts.Chart, {\n        height: height,\n        padding: padding,\n        data: dv,\n        scale: cols,\n        forceFit: true\n      }, _react2.default.createElement(_bizcharts.Axis, {\n        name: 'x'\n      }), _react2.default.createElement(_bizcharts.Tooltip, null), _react2.default.createElement(_bizcharts.Legend, {\n        name: 'key',\n        position: 'top'\n      }), _react2.default.createElement(_bizcharts.Geom, {\n        type: 'line',\n        position: 'x*value',\n        size: borderWidth,\n        color: 'key'\n      })), _react2.default.createElement('div', {\n        style: {\n          marginRight: -20\n        }\n      }, _react2.default.createElement(SliderGen, null))));\n    }\n  }]);\n\n  return TimelineChart;\n}(_react2.default.Component)) || _class);\nexports.default = TimelineChart;\nmodule.exports = exports.default;","map":null,"metadata":{},"sourceType":"script"}