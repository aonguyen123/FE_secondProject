{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _dec, _dec2, _dec3, _class, _desc, _value, _class2;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _bizcharts = require('bizcharts');\n\nvar _dataSet = require('@antv/data-set');\n\nvar _dataSet2 = _interopRequireDefault(_dataSet);\n\nvar _debounce = require('lodash-decorators/debounce');\n\nvar _debounce2 = _interopRequireDefault(_debounce);\n\nvar _bind = require('lodash-decorators/bind');\n\nvar _bind2 = _interopRequireDefault(_bind);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _autoHeight = require('../autoHeight');\n\nvar _autoHeight2 = _interopRequireDefault(_autoHeight);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object['ke' + 'ys'](descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object['define' + 'Property'](target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nvar styles = {\n  'tagCloud': 'antd-pro-charts-tag-cloud-tagCloud'\n};\n/* eslint no-underscore-dangle: 0 */\n\n/* eslint no-param-reassign: 0 */\n\nvar imgUrl = 'https://gw.alipayobjects.com/zos/rmsportal/gWyeGLCdFFRavBGIDzWk.png';\nvar TagCloud = (_dec = (0, _autoHeight2.default)(), _dec2 = (0, _bind2.default)(), _dec3 = (0, _debounce2.default)(500), _dec(_class = (_class2 = function (_Component) {\n  _inherits(TagCloud, _Component);\n\n  function TagCloud() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, TagCloud);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = TagCloud.__proto__ || Object.getPrototypeOf(TagCloud)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\n      dv: null\n    }, _this.resize = function () {\n      _this.requestRef = requestAnimationFrame(function () {\n        _this.renderChart();\n      });\n    }, _this.saveRootRef = function (node) {\n      _this.root = node;\n    }, _this.initTagCloud = function () {\n      function getTextAttrs(cfg) {\n        return Object.assign({}, cfg.style, {\n          fillOpacity: cfg.opacity,\n          fontSize: cfg.origin._origin.size,\n          rotate: cfg.origin._origin.rotate,\n          text: cfg.origin._origin.text,\n          textAlign: 'center',\n          fontFamily: cfg.origin._origin.font,\n          fill: cfg.color,\n          textBaseline: 'Alphabetic'\n        });\n      } // 给point注册一个词云的shape\n\n\n      _bizcharts.Shape.registerShape('point', 'cloud', {\n        drawShape: function drawShape(cfg, container) {\n          var attrs = getTextAttrs(cfg);\n          return container.addShape('text', {\n            attrs: Object.assign(attrs, {\n              x: cfg.x,\n              y: cfg.y\n            })\n          });\n        }\n      });\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(TagCloud, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      requestAnimationFrame(function () {\n        _this2.initTagCloud();\n\n        _this2.renderChart();\n      });\n      window.addEventListener('resize', this.resize, {\n        passive: true\n      });\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate(preProps) {\n      var data = this.props.data;\n\n      if (JSON.stringify(preProps.data) !== JSON.stringify(data)) {\n        this.renderChart(this.props);\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this.isUnmount = true;\n      window.cancelAnimationFrame(this.requestRef);\n      window.removeEventListener('resize', this.resize);\n    }\n  }, {\n    key: 'renderChart',\n    value: function renderChart(nextProps) {\n      var _this3 = this; // const colors = ['#1890FF', '#41D9C7', '#2FC25B', '#FACC14', '#9AE65C'];\n\n\n      var _ref2 = nextProps || this.props,\n          data = _ref2.data,\n          height = _ref2.height;\n\n      if (data.length < 1 || !this.root) {\n        return;\n      }\n\n      var h = height;\n      var w = this.root.offsetWidth;\n\n      var onload = function onload() {\n        var dv = new _dataSet2.default.View().source(data);\n        var range = dv.range('value');\n\n        var _range = _slicedToArray(range, 2),\n            min = _range[0],\n            max = _range[1];\n\n        dv.transform({\n          type: 'tag-cloud',\n          fields: ['name', 'value'],\n          imageMask: _this3.imageMask,\n          font: 'Verdana',\n          size: [w, h],\n          // 宽高设置最好根据 imageMask 做调整\n          padding: 0,\n          timeInterval: 5000,\n          // max execute time\n          rotate: function rotate() {\n            return 0;\n          },\n          fontSize: function fontSize(d) {\n            // eslint-disable-next-line\n            return Math.pow((d.value - min) / (max - min), 2) * (17.5 - 5) + 5;\n          }\n        });\n\n        if (_this3.isUnmount) {\n          return;\n        }\n\n        _this3.setState({\n          dv: dv,\n          w: w,\n          h: h\n        });\n      };\n\n      if (!this.imageMask) {\n        this.imageMask = new Image();\n        this.imageMask.crossOrigin = '';\n        this.imageMask.src = imgUrl;\n        this.imageMask.onload = onload;\n      } else {\n        onload();\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          className = _props.className,\n          height = _props.height;\n      var _state = this.state,\n          dv = _state.dv,\n          w = _state.w,\n          h = _state.h;\n      return _react2.default.createElement('div', {\n        className: (0, _classnames2.default)(styles.tagCloud, className),\n        style: {\n          width: '100%',\n          height: height\n        },\n        ref: this.saveRootRef\n      }, dv && _react2.default.createElement(_bizcharts.Chart, {\n        width: w,\n        height: h,\n        data: dv,\n        padding: 0,\n        scale: {\n          x: {\n            nice: false\n          },\n          y: {\n            nice: false\n          }\n        }\n      }, _react2.default.createElement(_bizcharts.Tooltip, {\n        showTitle: false\n      }), _react2.default.createElement(_bizcharts.Coord, {\n        reflect: 'y'\n      }), _react2.default.createElement(_bizcharts.Geom, {\n        type: 'point',\n        position: 'x*y',\n        color: 'text',\n        shape: 'cloud',\n        tooltip: ['text*value', function trans(text, value) {\n          return {\n            name: text,\n            value: value\n          };\n        }]\n      })));\n    }\n  }]);\n\n  return TagCloud;\n}(_react.Component), _applyDecoratedDescriptor(_class2.prototype, 'renderChart', [_dec2, _dec3], Object.getOwnPropertyDescriptor(_class2.prototype, 'renderChart'), _class2.prototype), _class2)) || _class);\nexports.default = TagCloud;\nmodule.exports = exports.default;","map":null,"metadata":{},"sourceType":"script"}